<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel ADM</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial;}
body{background:#0b0f1a;color:white;height:100vh;display:flex;flex-direction:column;}
.navbar{background:#111827;padding:15px;display:flex;align-items:center;gap:15px;}
.menu-btn{cursor:pointer;font-size:22px;}
.sidebar{position:fixed;left:-250px;top:0;width:230px;height:100%;background:#1f2937;transition:.3s;padding-top:60px;z-index:1000;}
.sidebar a{display:block;padding:15px;color:white;text-decoration:none;border-bottom:1px solid #374151;cursor:pointer;}
.sidebar a:hover{background:#00ff8830;}
.sidebar.active{left:0;}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);display:none;z-index:900;}
.overlay.active{display:block;}
.content{padding:20px;flex:1;overflow-y:auto;}
.card{background:#111827;padding:20px;border-radius:10px;margin-bottom:20px;}
button{padding:10px;background:#00ff88;border:none;border-radius:6px;cursor:pointer;margin-top:10px;}
button:hover{opacity:.8;}
input, select{padding:8px;border-radius:5px;border:none;margin:5px 0;width:100%;color:black;}
label{color:white;font-weight:bold;}
</style>
</head>
<body>

<div class="navbar">
<div class="menu-btn" onclick="toggleMenu()">â˜°</div>
<h3>Painel ADM</h3>
</div>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<div class="sidebar" id="sidebar">
<a onclick="loadDashboard()">ðŸ“Š Dashboard</a>
<a onclick="generateKeyUI()">âš¡ Gerar Key</a>
<a onclick="viewUsers()">ðŸ‘¥ Ver UsuÃ¡rios</a>
<a onclick="manageCredits()">ðŸ’° Gerenciar CrÃ©ditos</a>
<a onclick="viewKeys()">ðŸ“‚ Ver Todas Keys</a>
<a onclick="logout()">ðŸšª Sair</a>
</div>

<div class="content" id="content"></div>

<script>
// ProteÃ§Ã£o ADM
if(localStorage.getItem("role")!=="admin"){window.location.href="index.html";}

// Inicializa usuÃ¡rios e keys caso nÃ£o existam
if(!localStorage.getItem("users")){
  let defaultUsers = {
    "ADM": {credits:100, role:"admin"},
    "User1": {credits:10, role:"user"}
  };
  localStorage.setItem("users", JSON.stringify(defaultUsers));
}
if(!localStorage.getItem("keys")){
  localStorage.setItem("keys", JSON.stringify([]));
}

let users = JSON.parse(localStorage.getItem("users"));
let keys = JSON.parse(localStorage.getItem("keys"));
let currentUser = localStorage.getItem("currentUser") || "ADM";

// Menu toggle
function toggleMenu(){sidebar.classList.toggle("active");overlay.classList.toggle("active");}

// ðŸ“Š Dashboard
function loadDashboard(){
  let totalCredits = Object.values(users).reduce((a,b)=>a.credits+a,0);
  content.innerHTML=`<div class="card">
  <h3>ðŸ“Š Dashboard</h3>
  <p>Total usuÃ¡rios: ${Object.keys(users).length}</p>
  <p>Total keys: ${keys.length}</p>
  <p>Total crÃ©ditos no sistema: ${totalCredits}</p>
  <p>Seu saldo ADM: ${users[currentUser].credits}</p>
  </div>`;
}

// âš¡ Gerar Key (sÃ³ para ADM)
function generateKeyUI(){
  let creditCost = 1;
  content.innerHTML = `<div class="card">
  <h3>âš¡ Gerar Key (Para vocÃª)</h3>
  <p>CrÃ©ditos disponÃ­veis: ${users[currentUser].credits}</p>
  <label>Validade:</label>
  <select id="keyValidity">
    <option value="24h">24h</option>
    <option value="7d">7d</option>
    <option value="30d">30d</option>
  </select>
  <label>Quantidade de keys:</label>
  <input type="number" id="keyQty" value="1" min="1">
  <p>CrÃ©ditos por key: ${creditCost}</p>
  <button onclick="generateKeysForADM(${creditCost})">Gerar Key(s)</button>
  </div>`;
}

function generateKeysForADM(cost){
  let qty = parseInt(document.getElementById("keyQty").value);
  let validity = document.getElementById("keyValidity").value;
  let totalCost = qty*cost;

  if(users[currentUser].credits < totalCost){
    alert("CrÃ©ditos insuficientes!");
    return;
  }

  for(let i=0;i<qty;i++){
    let key = "KEY-"+Math.random().toString(36).substr(2,9).toUpperCase();
    keys.push({code:key,owner:currentUser,date:new Date().toLocaleDateString(),validity:validity,status:"active"});
  }

  users[currentUser].credits -= totalCost;
  localStorage.setItem("users",JSON.stringify(users));
  localStorage.setItem("keys",JSON.stringify(keys));
  alert(`${qty} key(s) gerada(s)!`);
  generateKeyUI();
}

// ðŸ‘¥ Ver UsuÃ¡rios
function viewUsers(){
  let html="<div class='card'><h3>ðŸ‘¥ Todos os UsuÃ¡rios</h3>";
  for(const user in users){
    const credits = users[user]?.credits || 0;
    html+=`<p>${user} | CrÃ©ditos: ${credits}</p>`;
  }
  html+="</div>";
  content.innerHTML=html;
}

// ðŸ’° Gerenciar CrÃ©ditos (digitar nome)
function manageCredits(){
  content.innerHTML = `<div class="card">
  <h3>ðŸ’° Gerenciar CrÃ©ditos</h3>
  <label>Nome do usuÃ¡rio:</label>
  <input type="text" id="creditUser" placeholder="Digite o nome do usuÃ¡rio">
  <label>Adicionar crÃ©ditos:</label>
  <input type="number" id="addCredits" value="0" min="0">
  <label>Remover crÃ©ditos:</label>
  <input type="number" id="removeCredits" value="0" min="0">
  <button onclick="updateCredits()">Atualizar CrÃ©ditos</button>
  </div>`;
}

function updateCredits(){
  let user = document.getElementById("creditUser").value.trim();
  let add = parseInt(document.getElementById("addCredits").value) || 0;
  let remove = parseInt(document.getElementById("removeCredits").value) || 0;

  if(!users[user]){
    alert("UsuÃ¡rio nÃ£o encontrado!");
    return;
  }

  users[user].credits = (users[user].credits + add) - remove;
  if(users[user].credits<0) users[user].credits=0;
  localStorage.setItem("users",JSON.stringify(users));
  alert(`CrÃ©ditos atualizados para ${user}: ${users[user].credits}`);
  manageCredits();
}

// ðŸ“‚ Ver todas as keys
function viewKeys(){
  let html="<div class='card'><h3>ðŸ“‚ Todas as Keys</h3>";
  if(keys.length===0){html+="<p>Nenhuma key gerada ainda.</p>";}else{
    keys.forEach(k=>{html+=`<p>${k.code} | Dono: ${k.owner} | Validade: ${k.validity} | ${k.status}</p>`;});
  }
  html+="</div>";
  content.innerHTML=html;
}

// Logout
function logout(){localStorage.clear();window.location.href="index.html";}

// Inicializa
loadDashboard();
</script>
</body>
</html>
