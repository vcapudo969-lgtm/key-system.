<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel UsuÃ¡rio</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial;}
body{height:100vh;background:#0b0f1a;color:white;display:flex;flex-direction:column;}
.navbar{background:#111827;padding:15px;display:flex;align-items:center;gap:15px;}
.menu-btn{cursor:pointer;font-size:22px;}
.sidebar{position:fixed;left:-250px;top:0;width:230px;height:100%;background:#1f2937;transition:.3s;padding-top:60px;z-index:1000;}
.sidebar a{display:block;padding:15px;color:white;text-decoration:none;border-bottom:1px solid #374151;cursor:pointer;}
.sidebar a:hover{background:#00ff8830;}
.sidebar.active{left:0;}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);display:none;z-index:900;}
.overlay.active{display:block;}
.content{padding:20px;flex:1;overflow-y:auto;}
.card{background:#111827;padding:20px;border-radius:10px;margin-bottom:20px;}
button{padding:10px;background:#00ff88;border:none;border-radius:6px;cursor:pointer;margin-top:10px;}
button:hover{opacity:.8;}
input, select{padding:8px;border-radius:5px;border:none;margin:5px 0;width:100%;color:black;}
label{color:white;font-weight:bold;}
</style>
</head>
<body>

<div class="navbar">
<div class="menu-btn" onclick="toggleMenu()">â˜°</div>
<h3>Painel UsuÃ¡rio</h3>
</div>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<div class="sidebar" id="sidebar">
<a onclick="showDashboard()">ðŸ“Š Dashboard</a>
<a onclick="generateKeyUI()">âš¡ Gerar Key</a>
<a onclick="viewMyKeys()">ðŸ”‘ Minhas Keys</a>
<a onclick="logout()">ðŸšª Sair</a>
</div>

<div class="content" id="content"></div>

<script>
if(localStorage.getItem("role")!=="user"){window.location.href="index.html";}
let currentUser = localStorage.getItem("currentUser");
let users = JSON.parse(localStorage.getItem("users")) || {};
let keys = JSON.parse(localStorage.getItem("keys")) || [];

function toggleMenu(){sidebar.classList.toggle("active");overlay.classList.toggle("active");}

// ðŸ“Š Dashboard
function showDashboard(){
content.innerHTML=`<div class="card"><h3>ðŸ“Š Dashboard</h3>
<p>Email: ${currentUser}</p>
<p>CrÃ©ditos disponÃ­veis: ${users[currentUser].credits}</p>
<p>Total Keys: ${keys.filter(k=>k.owner===currentUser).length}</p>
</div>`;
}
showDashboard();

// âš¡ Gerar Key UI
function generateKeyUI(){
let creditCost = 1; // custo por key
content.innerHTML = `
<div class="card">
<h3>âš¡ Gerar Key</h3>
<p>CrÃ©ditos disponÃ­veis: ${users[currentUser].credits}</p>
<label>Validade:</label>
<select id="keyValidity">
<option value="24h">24h</option>
<option value="7d">7d</option>
<option value="30d">30d</option>
</select>
<label>Quantidade de keys:</label>
<input type="number" id="keyQty" value="1" min="1">
<button onclick="generateUserKeys(${creditCost})">Gerar Key(s)</button>
</div>
`;
}

// Gerar keys e gastar crÃ©ditos
function generateUserKeys(cost){
let qty = parseInt(document.getElementById("keyQty").value);
let validity = document.getElementById("keyValidity").value;
let totalCost = qty * cost;

if(users[currentUser].credits < totalCost){
    alert("CrÃ©ditos insuficientes!");
    return;
}

for(let i=0;i<qty;i++){
    let key = "KEY-"+Math.random().toString(36).substr(2,9).toUpperCase();
    keys.push({code:key,owner:currentUser,date:new Date().toLocaleDateString(),validity:validity});
}

users[currentUser].credits -= totalCost;
localStorage.setItem("users",JSON.stringify(users));
localStorage.setItem("keys",JSON.stringify(keys));
alert(`${qty} key(s) gerada(s)!`);
generateKeyUI(); // atualizar painel com crÃ©ditos atualizados
}

// ðŸ”‘ Ver minhas keys
function viewMyKeys(){
let userKeys = keys.filter(k=>k.owner===currentUser);
let html="<div class='card'><h3>ðŸ”‘ Minhas Keys</h3>";
if(userKeys.length===0){html+="<p>Nenhuma key gerada ainda.</p>";}else{userKeys.forEach(k=>{html+=`<p>${k.code} | Validade: ${k.validity} | ${k.date}</p>`;});}
html+="</div>";
content.innerHTML=html;
}

// ðŸšª Logout
function logout(){localStorage.clear();window.location.href="index.html";}
</script>

</body>
</html>
